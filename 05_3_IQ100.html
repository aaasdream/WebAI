<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>IQ100 æ™ºåŠ›å•ç­”éŠæˆ²</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f2f5;
        }

        #gameContainer {
            text-align: center;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .state {
            display: none;
        }

        .active {
            display: block;
        }

        .start-button, .option-button, .next-button {
            padding: 15px 30px;
            font-size: 18px;
            margin: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s;
            background-color: #4CAF50;
            color: white;
        }

        .start-button:hover, .option-button:hover, .next-button:hover {
            transform: scale(1.05);
        }

        .option-button {
            width: 80%;
            text-align: left;
            background-color: #f8f9fa;
            color: #333;
            border: 2px solid #ddd;
        }

        .option-button.correct {
            background-color: #4CAF50;
            color: white;
        }

        .option-button.wrong {
            background-color: #f44336;
            color: white;
        }

        .score {
            font-size: 24px;
            margin: 20px 0;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .shake {
            animation: shake 0.5s;
        }

        #stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        .thinking {
            font-size: 20px;
            color: #666;
            margin: 20px 0;
        }

        .thinking::after {
            content: '...';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <!-- é–‹å§‹ç•«é¢ -->
        <div id="startState" class="state active">
            <h1>ğŸ§  IQ100 æ™ºåŠ›å•ç­”éŠæˆ² ğŸ®</h1>
            <button class="start-button" onclick="é–‹å§‹éŠæˆ²()">é–‹å§‹éŠæˆ² ğŸ¯</button>
        </div>

        <!-- AIç”Ÿæˆé¡Œç›®ç‹€æ…‹ -->
        <div id="generatingState" class="state">
            <div class="thinking">AI æ­£åœ¨æ€è€ƒå•é¡Œä¸­ ğŸ¤”</div>
        </div>

        <!-- ç­”é¡Œç‹€æ…‹ -->
        <div id="questionState" class="state">
            <div class="score">å¾—åˆ†: <span id="scoreDisplay">0</span></div>
            <div id="questionText"></div>
            <div id="options"></div>
        </div>

        <!-- éŠæˆ²çµæŸç‹€æ…‹ -->
        <div id="endState" class="state">
            <h2>éŠæˆ²çµæŸï¼</h2>
            <div class="score">æœ€çµ‚å¾—åˆ†: <span id="finalScore">0</span></div>
            <button class="start-button" onclick="é‡ç½®éŠæˆ²()">é‡æ–°é–‹å§‹ ğŸ”„</button>
        </div>
    </div>

    <canvas id="stars"></canvas>

    <script>
        const APIé‡‘é‘° = 'xai-33XUsyMtsKwFsYNNKCbsOCoMsp4rnSjERK3MxLLAaR3kjO9eEaIwH6SXF7KIjw91OswhE1vgweXZKpE9';
        let ç›®å‰åˆ†æ•¸ = 0;
        let é¡Œç›®è¨ˆæ•¸ = 0;
        let ä¹‹å‰çš„é¡Œç›® = [];
        let ç›®å‰é¡Œç›® = null;

        /**
         * åˆ‡æ›éŠæˆ²ç‹€æ…‹é¡¯ç¤º
         * @param {string} ç‹€æ…‹ID - è¦é¡¯ç¤ºçš„ç‹€æ…‹å€å¡ŠID
         */
        function é¡¯ç¤ºç‹€æ…‹(ç‹€æ…‹ID) {
            // éš±è—æ‰€æœ‰ç‹€æ…‹
            document.querySelectorAll('.state').forEach(ç‹€æ…‹ => ç‹€æ…‹.classList.remove('active'));
            // é¡¯ç¤ºæŒ‡å®šç‹€æ…‹
            document.getElementById(ç‹€æ…‹ID).classList.add('active');
        }

        /**
         * é–‹å§‹æ–°éŠæˆ²
         */
        function é–‹å§‹éŠæˆ²() {
            ç›®å‰åˆ†æ•¸ = 0;
            é¡Œç›®è¨ˆæ•¸ = 0;
            ä¹‹å‰çš„é¡Œç›® = [];
            ç”¢ç”Ÿé¡Œç›®();
        }

        /**
         * é‡ç½®éŠæˆ²ç‹€æ…‹
         */
        function é‡ç½®éŠæˆ²() {
            é¡¯ç¤ºç‹€æ…‹('startState');
        }

        /**
         * å‘ AI è«‹æ±‚ä¸¦ç”¢ç”Ÿæ–°é¡Œç›®
         */
        async function ç”¢ç”Ÿé¡Œç›®() {
            é¡¯ç¤ºç‹€æ…‹('generatingState');
            
            const æç¤ºæ–‡å­— = `è«‹ç”Ÿæˆä¸€å€‹å°å­¸ç”Ÿçš„ç™¾ç§‘çŸ¥è­˜å•ç­”é¡Œç›®ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
            {
                "question": "å•é¡Œå…§å®¹",
                "options": {
                    "A": "é¸é …A",
                    "B": "é¸é …B",
                    "C": "é¸é …C",
                    "D": "é¸é …D"
                },
                "answer": "æ­£ç¢ºç­”æ¡ˆå­—æ¯"
            }
            è«‹åªè¿”å›ç´”JSONæ ¼å¼ï¼Œä¸è¦åŠ å…¥å…¶ä»–æ–‡å­—ã€‚
            é€™æ˜¯ä¹‹å‰å‡ºéçš„é¡Œç›®è«‹ä¸è¦é‡è¤‡ï¼š${JSON.stringify(ä¹‹å‰çš„é¡Œç›®)}`;

            try {
                // ç™¼é€ API è«‹æ±‚
                const å›æ‡‰ = await fetch('https://api.x.ai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${APIé‡‘é‘°}`
                    },
                    body: JSON.stringify({
                        model: "grok-beta",
                        messages: [{
                            role: "user",
                            content: æç¤ºæ–‡å­—
                        }]
                    })
                });

                const è³‡æ–™ = await å›æ‡‰.json();
                console.log('AI å›æ‡‰:', è³‡æ–™);

                // è§£æ JSON å›æ‡‰
                const å…§å®¹ = è³‡æ–™.choices[0].message.content;
                const JSONç¬¦åˆ = å…§å®¹.match(/\{[\s\S]*\}/);
                
                if (JSONç¬¦åˆ) {
                    ç›®å‰é¡Œç›® = JSON.parse(JSONç¬¦åˆ[0]);
                    ä¹‹å‰çš„é¡Œç›®.push(ç›®å‰é¡Œç›®);
                    é¡¯ç¤ºé¡Œç›®(ç›®å‰é¡Œç›®);
                } else {
                    console.error('ç„¡æ³•è§£æJSON');
                    document.getElementById('generatingState').innerHTML += `
                        <div>ç”Ÿæˆå¤±æ•—ï¼Œè«‹é‡è©¦</div>
                        <button class="next-button" onclick="ç”¢ç”Ÿé¡Œç›®()">å†ç”Ÿæˆ</button>
                    `;
                }
            } catch (éŒ¯èª¤) {
                console.error('éŒ¯èª¤:', éŒ¯èª¤);
                document.getElementById('generatingState').innerHTML += `
                    <div>ç™¼ç”ŸéŒ¯èª¤ï¼š${éŒ¯èª¤.message}</div>
                    <button class="next-button" onclick="ç”¢ç”Ÿé¡Œç›®()">å†ç”Ÿæˆ</button>
                `;
            }
        }

        /**
         * é¡¯ç¤ºé¡Œç›®åˆ°ç•«é¢ä¸Š
         * @param {Object} é¡Œç›® - é¡Œç›®ç‰©ä»¶
         */
        function é¡¯ç¤ºé¡Œç›®(é¡Œç›®) {
            é¡¯ç¤ºç‹€æ…‹('questionState');
            document.getElementById('scoreDisplay').textContent = ç›®å‰åˆ†æ•¸;
            document.getElementById('questionText').innerHTML = `<h2>ğŸ“ ${é¡Œç›®.question}</h2>`;
            
            const é¸é …å®¹å™¨ = document.getElementById('options');
            é¸é …å®¹å™¨.innerHTML = '';
            
            // å»ºç«‹é¸é …æŒ‰éˆ•
            Object.entries(é¡Œç›®.options).forEach(([é¸é …, å…§å®¹]) => {
                const æŒ‰éˆ• = document.createElement('button');
                æŒ‰éˆ•.className = 'option-button';
                æŒ‰éˆ•.innerHTML = `${é¸é …}. ${å…§å®¹}`;
                æŒ‰éˆ•.onclick = () => æª¢æŸ¥ç­”æ¡ˆ(é¸é …);
                é¸é …å®¹å™¨.appendChild(æŒ‰éˆ•);
            });
        }

        /**
         * æª¢æŸ¥ç­”æ¡ˆæ˜¯å¦æ­£ç¢ºä¸¦è™•ç†çµæœ
         * @param {string} é¸æ“‡çš„ç­”æ¡ˆ - ä½¿ç”¨è€…é¸æ“‡çš„é¸é …
         */
        function æª¢æŸ¥ç­”æ¡ˆ(é¸æ“‡çš„ç­”æ¡ˆ) {
            const æ˜¯å¦æ­£ç¢º = é¸æ“‡çš„ç­”æ¡ˆ === ç›®å‰é¡Œç›®.answer;
            const æŒ‰éˆ•å€‘ = document.querySelectorAll('.option-button');
            
            // åœç”¨æ‰€æœ‰æŒ‰éˆ•ä¸¦æ¨™ç¤ºæ­£ç¢º/éŒ¯èª¤ç­”æ¡ˆ
            æŒ‰éˆ•å€‘.forEach(æŒ‰éˆ• => {
                æŒ‰éˆ•.disabled = true;
                const æŒ‰éˆ•ç­”æ¡ˆ = æŒ‰éˆ•.innerHTML[0];
                if (æŒ‰éˆ•ç­”æ¡ˆ === ç›®å‰é¡Œç›®.answer) {
                    æŒ‰éˆ•.classList.add('correct');
                } else if (æŒ‰éˆ•ç­”æ¡ˆ === é¸æ“‡çš„ç­”æ¡ˆ && !æ˜¯å¦æ­£ç¢º) {
                    æŒ‰éˆ•.classList.add('wrong');
                }
            });

            // è™•ç†ç­”å°/ç­”éŒ¯æ•ˆæœ
            if (æ˜¯å¦æ­£ç¢º) {
                ç›®å‰åˆ†æ•¸ += 10;
                å‰µå»ºæ˜Ÿæ˜Ÿçˆ†ç‚¸();
            } else {
                document.getElementById('questionState').classList.add('shake');
                setTimeout(() => {
                    document.getElementById('questionState').classList.remove('shake');
                }, 500);
            }

            é¡Œç›®è¨ˆæ•¸++;
            setTimeout(() => {
                if (é¡Œç›®è¨ˆæ•¸ >= 10) {
                    çµæŸéŠæˆ²();
                } else {
                    ç”¢ç”Ÿé¡Œç›®();
                }
            }, 1500);
        }

/**
 * å‰µå»ºç­”å°æ™‚çš„æ˜Ÿæ˜Ÿçˆ†ç‚¸å‹•ç•«æ•ˆæœ
 * åŒ…å«æ›´å¤§çš„æ˜Ÿæ˜Ÿå’Œé‡åŠ›æ•ˆæœ
 */
function å‰µå»ºæ˜Ÿæ˜Ÿçˆ†ç‚¸() {
    const ç•«å¸ƒ = document.getElementById('stars');
    const ç¹ªåœ–ç’°å¢ƒ = ç•«å¸ƒ.getContext('2d');
    ç•«å¸ƒ.width = window.innerWidth;
    ç•«å¸ƒ.height = window.innerHeight;

    // é‡åŠ›ç›¸é—œå¸¸æ•¸
    const é‡åŠ› = 0.5;  // é‡åŠ›åŠ é€Ÿåº¦
    const åå½ˆä¿‚æ•¸ = 0.6;  // ç¢°æ’åœ°é¢å¾Œçš„åå½ˆåŠ›åº¦

    const æ˜Ÿæ˜Ÿå€‘ = [];
    // ç”¢ç”Ÿ30é¡†è¼ƒå¤§çš„æ˜Ÿæ˜Ÿ
    for (let i = 0; i < 30; i++) {
        æ˜Ÿæ˜Ÿå€‘.push({
            x: window.innerWidth / 2,
            y: window.innerHeight / 2,
            å¤§å°: Math.random() * 8 + 5,  // å¢åŠ æ˜Ÿæ˜Ÿå¤§å°ç¯„åœ
            é€Ÿåº¦X: (Math.random() - 0.5) * 15,  // æ°´å¹³é€Ÿåº¦
            é€Ÿåº¦Y: -Math.random() * 15,  // å‘ä¸Šçš„åˆå§‹é€Ÿåº¦
            é€æ˜åº¦: 1,
            é¡è‰²: `hsl(${Math.random() * 60 + 40}, 100%, 50%)`  // é‡‘é»ƒè‰²ç³»çš„éš¨æ©Ÿè‰²å½©
        });
    }

    function å‹•ç•«() {
        // ä½¿ç”¨åŠé€æ˜èƒŒæ™¯è£½é€ æ‹–å°¾æ•ˆæœ
        ç¹ªåœ–ç’°å¢ƒ.fillStyle = 'rgba(0, 0, 0, 0.1)';
        ç¹ªåœ–ç’°å¢ƒ.fillRect(0, 0, ç•«å¸ƒ.width, ç•«å¸ƒ.height);
        
        let ä»ç„¶å¯è¦‹ = false;

        æ˜Ÿæ˜Ÿå€‘.forEach(æ˜Ÿæ˜Ÿ => {
            // æ›´æ–°ä½ç½®
            æ˜Ÿæ˜Ÿ.x += æ˜Ÿæ˜Ÿ.é€Ÿåº¦X;
            æ˜Ÿæ˜Ÿ.y += æ˜Ÿæ˜Ÿ.é€Ÿåº¦Y;
            
            // åŠ å…¥é‡åŠ›æ•ˆæœ
            æ˜Ÿæ˜Ÿ.é€Ÿåº¦Y += é‡åŠ›;

            // åœ°é¢ç¢°æ’æª¢æ¸¬
            if (æ˜Ÿæ˜Ÿ.y + æ˜Ÿæ˜Ÿ.å¤§å° > ç•«å¸ƒ.height) {
                æ˜Ÿæ˜Ÿ.y = ç•«å¸ƒ.height - æ˜Ÿæ˜Ÿ.å¤§å°;
                æ˜Ÿæ˜Ÿ.é€Ÿåº¦Y = -æ˜Ÿæ˜Ÿ.é€Ÿåº¦Y * åå½ˆä¿‚æ•¸;
                // æ¸›å°‘æ°´å¹³é€Ÿåº¦ï¼ˆæ¨¡æ“¬æ‘©æ“¦ï¼‰
                æ˜Ÿæ˜Ÿ.é€Ÿåº¦X *= 0.8;
            }

            // ç‰†å£ç¢°æ’æª¢æ¸¬
            if (æ˜Ÿæ˜Ÿ.x + æ˜Ÿæ˜Ÿ.å¤§å° > ç•«å¸ƒ.width || æ˜Ÿæ˜Ÿ.x - æ˜Ÿæ˜Ÿ.å¤§å° < 0) {
                æ˜Ÿæ˜Ÿ.é€Ÿåº¦X *= -0.8;
            }

            // é€æ¼¸é™ä½é€æ˜åº¦
            æ˜Ÿæ˜Ÿ.é€æ˜åº¦ -= 0.005;

            // ç¹ªè£½æ˜Ÿæ˜Ÿ
            if (æ˜Ÿæ˜Ÿ.é€æ˜åº¦ > 0) {
                ä»ç„¶å¯è¦‹ = true;
                ç¹ªåœ–ç’°å¢ƒ.beginPath();
                ç¹ªåœ–ç’°å¢ƒ.fillStyle = `hsla(${æ˜Ÿæ˜Ÿ.é¡è‰²}, ${æ˜Ÿæ˜Ÿ.é€æ˜åº¦})`;
                
                // ç¹ªè£½ç™¼å…‰æ•ˆæœ
                const æ¼¸å±¤ = ç¹ªåœ–ç’°å¢ƒ.createRadialGradient(
                    æ˜Ÿæ˜Ÿ.x, æ˜Ÿæ˜Ÿ.y, 0,
                    æ˜Ÿæ˜Ÿ.x, æ˜Ÿæ˜Ÿ.y, æ˜Ÿæ˜Ÿ.å¤§å°
                );
                æ¼¸å±¤.addColorStop(0, `rgba(255, 255, 200, ${æ˜Ÿæ˜Ÿ.é€æ˜åº¦})`);
                æ¼¸å±¤.addColorStop(0.4, `rgba(255, 200, 0, ${æ˜Ÿæ˜Ÿ.é€æ˜åº¦ * 0.8})`);
                æ¼¸å±¤.addColorStop(1, `rgba(255, 100, 0, 0)`);
                
                ç¹ªåœ–ç’°å¢ƒ.fillStyle = æ¼¸å±¤;
                ç¹ªåœ–ç’°å¢ƒ.arc(æ˜Ÿæ˜Ÿ.x, æ˜Ÿæ˜Ÿ.y, æ˜Ÿæ˜Ÿ.å¤§å°, 0, Math.PI * 2);
                ç¹ªåœ–ç’°å¢ƒ.fill();

                // æ·»åŠ æ˜Ÿæ˜Ÿå…‰èŠ’æ•ˆæœ
                ç¹ªåœ–ç’°å¢ƒ.save();
                ç¹ªåœ–ç’°å¢ƒ.translate(æ˜Ÿæ˜Ÿ.x, æ˜Ÿæ˜Ÿ.y);
                ç¹ªåœ–ç’°å¢ƒ.rotate(Math.PI / 4);
                
                for (let i = 0; i < 4; i++) {
                    ç¹ªåœ–ç’°å¢ƒ.rotate(Math.PI / 2);
                    ç¹ªåœ–ç’°å¢ƒ.beginPath();
                    ç¹ªåœ–ç’°å¢ƒ.moveTo(0, -æ˜Ÿæ˜Ÿ.å¤§å° * 1.5);
                    ç¹ªåœ–ç’°å¢ƒ.lineTo(0, æ˜Ÿæ˜Ÿ.å¤§å° * 1.5);
                    ç¹ªåœ–ç’°å¢ƒ.strokeStyle = `rgba(255, 255, 200, ${æ˜Ÿæ˜Ÿ.é€æ˜åº¦ * 0.3})`;
                    ç¹ªåœ–ç’°å¢ƒ.lineWidth = 2;
                    ç¹ªåœ–ç’°å¢ƒ.stroke();
                }
                
                ç¹ªåœ–ç’°å¢ƒ.restore();
            }
        });

        // å¦‚æœé‚„æœ‰å¯è¦‹çš„æ˜Ÿæ˜Ÿï¼Œç¹¼çºŒå‹•ç•«
        if (ä»ç„¶å¯è¦‹) {
            requestAnimationFrame(å‹•ç•«);
        } else {
            // æ¸…é™¤ç•«å¸ƒ
            ç¹ªåœ–ç’°å¢ƒ.clearRect(0, 0, ç•«å¸ƒ.width, ç•«å¸ƒ.height);
        }
    }

    å‹•ç•«();
}



        function çµæŸéŠæˆ²() {
            document.getElementById('finalScore').textContent = ç›®å‰åˆ†æ•¸;
            é¡¯ç¤ºç‹€æ…‹('endState');
        }
    </script>
</body>
</html>